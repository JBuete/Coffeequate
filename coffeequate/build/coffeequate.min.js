/**
 * almond 0.2.6 Copyright (c) 2011-2012, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/jrburke/almond for details
 */

!function(t,n){"function"==typeof define&&define.amd?define(n):t.libGlobalName=n()}(this,function(){var t,n,e;return function(i){function r(t,n){return w.call(t,n)}function l(t,n){var e,i,r,l,o,a,s,u,h,c,f=n&&n.split("/"),p=v.map,d=p&&p["*"]||{};if(t&&"."===t.charAt(0))if(n){for(f=f.slice(0,f.length-1),t=f.concat(t.split("/")),u=0;u<t.length;u+=1)if(c=t[u],"."===c)t.splice(u,1),u-=1;else if(".."===c){if(1===u&&(".."===t[2]||".."===t[0]))break;u>0&&(t.splice(u-1,2),u-=2)}t=t.join("/")}else 0===t.indexOf("./")&&(t=t.substring(2));if((f||d)&&p){for(e=t.split("/"),u=e.length;u>0;u-=1){if(i=e.slice(0,u).join("/"),f)for(h=f.length;h>0;h-=1)if(r=p[f.slice(0,h).join("/")],r&&(r=r[i])){l=r,o=u;break}if(l)break;!a&&d&&d[i]&&(a=d[i],s=u)}!l&&a&&(l=a,o=s),l&&(e.splice(0,o,l),t=e.join("/"))}return t}function o(t,n){return function(){return p.apply(i,M.call(arguments,0).concat([t,n]))}}function a(t){return function(n){return l(n,t)}}function s(t){return function(n){g[t]=n}}function u(t){if(r(m,t)){var n=m[t];delete m[t],b[t]=!0,f.apply(i,n)}if(!r(g,t)&&!r(b,t))throw new Error("No "+t);return g[t]}function h(t){var n,e=t?t.indexOf("!"):-1;return e>-1&&(n=t.substring(0,e),t=t.substring(e+1,t.length)),[n,t]}function c(t){return function(){return v&&v.config&&v.config[t]||{}}}var f,p,d,y,g={},m={},v={},b={},w=Object.prototype.hasOwnProperty,M=[].slice;d=function(t,n){var e,i=h(t),r=i[0];return t=i[1],r&&(r=l(r,n),e=u(r)),r?t=e&&e.normalize?e.normalize(t,a(n)):l(t,n):(t=l(t,n),i=h(t),r=i[0],t=i[1],r&&(e=u(r))),{f:r?r+"!"+t:t,n:t,pr:r,p:e}},y={require:function(t){return o(t)},exports:function(t){var n=g[t];return"undefined"!=typeof n?n:g[t]={}},module:function(t){return{id:t,uri:"",exports:g[t],config:c(t)}}},f=function(t,n,e,l){var a,h,c,f,p,v,w=[];if(l=l||t,"function"==typeof e){for(n=!n.length&&e.length?["require","exports","module"]:n,p=0;p<n.length;p+=1)if(f=d(n[p],l),h=f.f,"require"===h)w[p]=y.require(t);else if("exports"===h)w[p]=y.exports(t),v=!0;else if("module"===h)a=w[p]=y.module(t);else if(r(g,h)||r(m,h)||r(b,h))w[p]=u(h);else{if(!f.p)throw new Error(t+" missing "+h);f.p.load(f.n,o(l,!0),s(h),{}),w[p]=g[h]}c=e.apply(g[t],w),t&&(a&&a.exports!==i&&a.exports!==g[t]?g[t]=a.exports:c===i&&v||(g[t]=c))}else t&&(g[t]=e)},t=n=p=function(t,n,e,r,l){return"string"==typeof t?y[t]?y[t](n):u(d(t,n).f):(t.splice||(v=t,n.splice?(t=n,n=e,e=null):t=i),n=n||function(){},"function"==typeof e&&(e=r,r=l),r?f(i,t,n,e):setTimeout(function(){f(i,t,n,e)},4),p)},p.config=function(t){return v=t,v.deps&&p(v.deps,v.callback),p},t._defined=g,e=function(t,n,e){n.splice||(e=n,n=[]),r(g,t)||r(m,t)||(m[t]=[t,n,e])},e.amd={jQuery:!0}}(),e("lib/almond",function(){}),function(){var t={}.hasOwnProperty,n=function(n,e){function i(){this.constructor=n}for(var r in e)t.call(e,r)&&(n[r]=e[r]);return i.prototype=e.prototype,n.prototype=new i,n.__super__=e.prototype,n};e("parse",["require"],function(t){var e,i,r;return e=function(t){function e(t,n){this.input=t,this.type=n}return n(e,t),e.prototype.toString=function(){return"Could not parse '"+this.input+"' as "+this.type},e}(Error),r=function(n){var i;if(i=t("terminals"),/^-?\d+(\.\d+)?$/.test(n)||/^-?\d+(\.\d+)?\/\d+(\.\d+)?$/.test(n))return new i.Constant(n);if(/^[a-zA-Z][a-zA-Z_\-\d]*$/.test(n))return new i.Variable(n);if(/^\\[a-zA-Z][a-zA-Z_\-\d]*$/.test(n))return new i.SymbolicConstant(n.slice(1));throw new e(n,"terminal")},i=function(){function n(e){return this.tokens=n.tokenise(e).reverse(),this.upto=0,this.operators=t("operators"),this.parseAddition()}return n.tokenise=function(t){return t.split(/(\*\*|[+*()\-]|\s)/).filter(function(t){return!/^\s*$/.test(t)})},n.prototype.getToken=function(){return this.tokens[this.upto]},n.prototype.parseAddition=function(){var t,n;return n=this.parseMultiplication(),"+"!==this.getToken()?n:(this.upto+=1,t=this.parseAddition(),new this.operators.Add(t,n))},n.prototype.parseMultiplication=function(){var t,n;return n=this.parsePower(),"*"!==this.getToken()?n:(this.upto+=1,t=this.parseMultiplication(),new this.operators.Mul(t,n))},n.prototype.parsePower=function(){var t,n;return t=this.parseBracket(),"**"!==this.getToken()?t:(this.upto+=1,n=this.parsePower(),new this.operators.Pow(n,t))},n.prototype.parseBracket=function(){var t,n;if(")"===this.getToken()){if(this.upto+=1,t=this.parseAddition(),"("!==this.getToken())throw new Error("ParseError: Expected '(' but found '"+this.getToken()+"' at position "+(""+(this.tokens.length-this.upto)+"/"+this.tokens.length+" in token stream '"+this.tokens.reverse().join(" ")+"'"));return this.upto+=1,"-"===this.getToken()?(this.upto+=1,new this.operators.Mul(-1,t)):t}return n=this.parseTerm(),"-"===this.getToken()?(this.upto+=1,new this.operators.Mul(-1,n)):n},n.prototype.parseTerm=function(){var t;return t=r(this.getToken()),this.upto+=1,t},n}(),{ParseError:e,stringToExpression:function(t){return new i(t)},constant:function(t){if("string"==typeof t||t instanceof String){if(""===t)throw new e("","constant");if(t=t.split("/"),1===t.length)return[parseFloat(t[0]),1];if(2===t.length)return[parseFloat(t[0]),parseFloat(t[1])];throw new e(t.join("/"),"constant")}if("number"==typeof t||t instanceof Number)return[t,1];throw new e(t,"constant")},stringToTerminal:r}})}.call(this),function(){e("generateInfo",[],function(){return{getMathMLInfo:function(t,n,e){var i,r,l,o;return null==e&&(e="0"),r=n?"expression":"equation",l=""+r+"-"+(null!=t?t:Math.floor(1e7*Math.random()).toString(16)),o=null!=t?'id="'+l+'"':"",i="<div "+o+' class="'+r+'"><math xmlns="http://www.w3.org/1998/Math/MathML">'+(null!=e?(isFinite(e)?"<mn>"+e+"</mn>":null!=e.toMathML?""+e.toMathML(t,n):"<mi>"+e+"</mi>")+"<mo>=</mo>":""),[r,l,i]},getHTMLInfo:function(t,n,e){var i,r,l,o;return null==e&&(e="0"),r=n?"expression":"equation",l=""+r+"-"+(null!=t?t:Math.floor(1e7*Math.random()).toString(16)),o=null!=t?'id="'+l+'"':"",i="<div "+o+' class="'+r+'">'+(null!=e?(null!=e.toHTML?""+e.toHTML(t,n):""+e)+"=":""),[r,l,i]}}})}.call(this),function(){var t={}.hasOwnProperty,n=function(n,e){function i(){this.constructor=n}for(var r in e)t.call(e,r)&&(n[r]=e[r]);return i.prototype=e.prototype,n.prototype=new i,n.__super__=e.prototype,n},i=[].indexOf||function(t){for(var n=0,e=this.length;e>n;n++)if(n in this&&this[n]===t)return n;return-1};e("terminals",["parse","generateInfo"],function(t,e){var r,l,o,a;return o=function(){function t(t){this.label=t}return t.prototype.evaluate=function(){},t.prototype.copy=function(){return new t(this.label)},t.prototype.toString=function(){return this.label},t}(),r=function(i){function r(n,e){var i,r;this.denominator=null!=e?e:null,this.cmp=-6,null!=this.denominator?(i=t.constant(n),this.numerator=i[0],e=i[1],this.denominator*=e):(r=t.constant(n),this.numerator=r[0],this.denominator=r[1])}return n(r,i),r.prototype.evaluate=function(){return this.numerator/this.denominator},r.prototype.copy=function(){return new r(this.numerator,this.denominator)},r.prototype.compareSameType=function(t){return this.evaluate()<t.evaluate()?-1:this.evaluate()===t.evaluate()?0:1},r.prototype.multiply=function(t){return new r(this.numerator*t.numerator,this.denominator*t.denominator)},r.prototype.add=function(t){return new r(t.denominator*this.numerator+this.denominator*t.numerator,this.denominator*t.denominator)},r.prototype.equals=function(t){return t instanceof r?this.evaluate()===t.evaluate():!1},r.prototype.replaceVariables=function(){return this.copy()},r.prototype.getAllVariables=function(){return[]},r.prototype.sub=function(){return this.copy()},r.prototype.simplify=function(){return this.copy()},r.prototype.expand=function(){return this.copy()},r.prototype.expandAndSimplify=function(){return this.copy()},r.prototype.substituteExpression=function(){return this.copy()},r.prototype.toMathML=function(t,n,i,r){var l,o,a,s,u;return null==n&&(n=!1),null==i&&(i="0"),null==r&&(r=!1),r?(u=e.getMathMLInfo(t,n,i),a=u[0],s=u[1],o=u[2],l="</math></div>"):(o="",l=""),1===this.denominator?o+("<mn>"+this.numerator+"</mn>")+l:o+("<mfrac><mrow><mn>"+this.numerator+"</mn></mrow><mrow><mn>"+this.denominator+"</mn></mrow></mfrac>")+l},r.prototype.toHTML=function(t,n,i,r){var l,o,a,s,u;return null==n&&(n=!1),null==i&&(i="0"),null==r&&(r=!1),u=e.getHTMLInfo(t,n,i),a=u[0],s=u[1],o=u[2],r?l="</div>":(o="",l=""),1===this.denominator?o+(""+this.numerator)+l:o+("("+this.numerator+"/"+this.denominator+")")+l},r.prototype.toLaTeX=function(){return 1===this.denominator?""+this.numerator:"\\frac{"+this.numerator+"}{"+this.denominator+"}"},r.prototype.toString=function(){return 1!==this.denominator?""+this.numerator+"/"+this.denominator:""+this.numerator},r}(o),l=function(t){function i(t,n){this.label=t,this.value=null!=n?n:null,this.cmp=-5}return n(i,t),i.prototype.copy=function(){return new i(this.label,this.value)},i.prototype.compareSameType=function(t){return this.label<t.label?-1:this.label===t.label?0:1},i.prototype.evaluate=function(){return this.value},i.prototype.equals=function(t){return t instanceof i?this.label===t.label&&this.value===t.value:!1},i.prototype.replaceVariables=function(){return this.copy()},i.prototype.getAllVariables=function(){return[]},i.prototype.sub=function(){return this.copy()},i.prototype.simplify=function(){return this.copy()},i.prototype.expand=function(){return this.copy()},i.prototype.expandAndSimplify=function(){return this.copy()},i.prototype.substituteExpression=function(){return this.copy()},i.prototype.toHTML=function(t,n,i,r){var l,o,a,s,u;return null==n&&(n=!1),null==i&&(i="0"),null==r&&(r=!1),r?(u=e.getHTMLInfo(t,n,i),a=u[0],s=u[1],o=u[2],l="</div>"):(o="",l=""),o+this.toString()+l},i.prototype.toMathML=function(t,n,i,r){var l,o,a,s,u;return null==n&&(n=!1),null==i&&(i="0"),null==r&&(r=!1),r?(u=e.getMathMLInfo(t,n,i),a=u[0],s=u[1],o=u[2],l="</math></div>"):(o="",l=""),""+o+"<mn>"+this.label+"</mn>"+l},i.prototype.toLaTeX=function(){return this.toString()},i}(o),a=function(t){function l(t){this.label=t,this.cmp=-4}return n(l,t),l.prototype.copy=function(){return new l(this.label)},l.prototype.compareSameType=function(t){return this.label<t.label?-1:this.label===t.label?0:1},l.prototype.equals=function(t,n){var e;return null==n&&(n=null),t instanceof l?null!=n?(e=this.label,i.call(n.get(t.label),e)>=0):t.label===this.label:!1},l.prototype.replaceVariables=function(t){return this.label in t?this.label=t[this.label]:void 0},l.prototype.getAllVariables=function(){return[this.label]},l.prototype.sub=function(t){var n;return this.label in t?(n=t[this.label],null!=n.copy?n.copy():new r(n)):this.copy()},l.prototype.substituteExpression=function(t,n,e,r){var l,o;return null==e&&(e=null),null==r&&(r=!1),null==e&&(e={get:function(t){return[t]}}),l=e.get(n),r&&(t=t.solve(n)[0]),this.label===n||(o=this.label,i.call(l,o)>=0)?t.copy():this.copy()},l.prototype.simplify=function(){return this.copy()},l.prototype.expand=function(){return this.copy()},l.prototype.expandAndSimplify=function(){return this.copy()},l.prototype.toMathML=function(t,n,i,r){var l,o,a,s,u,h,c,f;return null==n&&(n=!1),null==i&&(i="0"),null==r&&(r=!1),r?(f=e.getMathMLInfo(t,n,i),h=f[0],c=f[1],o=f[2],l="</div>"):(o="",l=""),s=this.label.split("-"),a=s[0],u=null!=s[1]?'id="variable-'+(n?"expression":"equation")+("-"+t+"-")+this.label+'"':"",a.length>1?o+'<msub class="variable"'+u+"><mi>"+a[0]+"</mi><mi>"+a.slice(1)+"</mi></msub>"+l:o+'<mi class="variable"'+u+">"+a+"</mi>"+l},l.prototype.toHTML=function(t,n,i,r){var l,o,a,s,u,h,c,f;return null==n&&(n=!1),null==i&&(i="0"),null==r&&(r=!1),r?(f=e.getHTMLInfo(t,n,i),h=f[0],c=f[1],o=f[2],l="</div>"):(o="",l=""),s=this.label.split("-"),a=s[0],u=null!=s[1]?'id="variable-'+(n?"expression":"equation")+("-"+t+"-")+this.label+'"':"",o+'<span class="variable"'+u+">"+a+"</span>"+l},l.prototype.toLaTeX=function(){return this.toString()},l}(o),{Terminal:o,Variable:a,Constant:r,SymbolicConstant:l}})}.call(this),function(){var t={}.hasOwnProperty,n=function(n,e){function i(){this.constructor=n}for(var r in e)t.call(e,r)&&(n[r]=e[r]);return i.prototype=e.prototype,n.prototype=new i,n.__super__=e.prototype,n};e("nodes",[],function(){var t;return t=function(){function t(t){this.label=t}return t.prototype.getChildren=function(){return[]},t}(),{BasicNode:t,RoseNode:function(t){function e(t,n){this.children=null!=n?n:null,null==this.children&&(this.children=[]),e.__super__.constructor.call(this,t)}return n(e,t),e.prototype.getChildren=function(){return this.children},e.prototype.toLisp=function(){return"("+this.label+(this.children?" ":"")+this.children.join(" ")+")"},e.prototype.toString=function(){return"("+this.children.join(" "+this.label+" ")+")"},e}(t),BinaryNode:function(t){function e(t,n,e){this.label=t,this.children={left:n,right:e}}return n(e,t),e.prototype.getChildren=function(){return[this.children.left,this.children.right]},e.prototype.toLisp=function(){return"("+this.label+" "+this.children.left+" "+this.children.right+")"},e.prototype.toString=function(){return"("+this.children.left+" "+this.label+" "+this.children.right+")"},e}(t)}})}.call(this),function(){var t={}.hasOwnProperty,n=function(n,e){function i(){this.constructor=n}for(var r in e)t.call(e,r)&&(n[r]=e[r]);return i.prototype=e.prototype,n.prototype=new i,n.__super__=e.prototype,n},i=[].slice,r=[].indexOf||function(t){for(var n=0,e=this.length;e>n;n++)if(n in this&&this[n]===t)return n;return-1};e("operators",["nodes","parse","terminals","generateInfo"],function(t,e,l,o){var a,s,u,h,c,f,p;return s=function(t){function e(t,n,i){null==i&&(i=null),e.__super__.constructor.call(this,"Unsolvable: "+t+" for "+n+(i?";"+i:""))}return n(e,t),e}(Error),p=function(t){var n,e,i,r;for(e=[],i=0,r=t.length;r>i;i++)n=t[i],n instanceof Array?e.push(p(n)):e.push("function"==typeof n.toString?n.toString():void 0);return"["+e.join(", ")+"]"},f=function(){var n,r,o,a,s;for(r=1<=arguments.length?i.call(arguments,0):[],o=[],a=0,s=r.length;s>a;a++)if(n=r[a],"string"==typeof n||n instanceof String)o.push(e.stringToTerminal(n));else if("number"==typeof n||n instanceof Number)o.push(new l.Constant(n));else{if(!(n instanceof l.Terminal||n instanceof t.BasicNode||null!=n.isTerminal))throw new Error("Invalid argument "+n+", ("+typeof n+"), ("+n.toString()+")");o.push(n)}return o},a=function(e){function a(){var t;if(t=1<=arguments.length?i.call(arguments,0):[],t.length<1)throw new Error("Add nodes must have at least one child.");this.cmp=-1,t=f.apply(null,t),a.__super__.constructor.call(this,"+",t)}return n(a,e),a.prototype.copy=function(){var t,n;return t=function(){var t,e,i,r;for(i=this.children,r=[],t=0,e=i.length;e>t;t++)n=i[t],r.push(null!=n.copy?n.copy():n);return r}.call(this),function(t,n,e){e.prototype=t.prototype;var i=new e,r=t.apply(i,n);return Object(r)===r?r:i}(a,t,function(){})},a.prototype.compareSameType=function(t){var n,e,i,r,l,o,a;for(r=this.children.length===t.children.length?0:this.children.length<t.children.length?-1:1,a=this.children,i=l=0,o=a.length;o>l;i=++l){if(e=a[i],null==t.children[i])return 1;if(n=c(this.children[i],t.children[i]),0!==n)return n}return r},a.prototype.expand=function(){var t,n,e,i,r,l,o,s,u,h;for(i=[],u=this.children,r=0,o=u.length;o>r;r++)if(e=u[r],null!=e.expand?e=e.expand():null!=e.copy&&(e=e.copy()),e instanceof a)for(h=e.children,l=0,s=h.length;s>l;l++)n=h[l],i.push(n);else i.push(e);return t=function(t,n,e){e.prototype=t.prototype;var i=new e,r=t.apply(i,n);return Object(r)===r?r:i}(a,i,function(){}),t.sort(),t},a.prototype.sort=function(){var t,n,e,i;for(i=this.children,n=0,e=i.length;e>n;n++)t=i[n],"function"==typeof t.sort&&t.sort();return this.children.sort(c)},a.prototype.equals=function(t,n){var e,i,r,l,o;if(!(t instanceof a))return!1;if(t.children.length!==this.children.length)return!1;for(o=this.children,i=r=0,l=o.length;l>r;i=++r)if(e=o[i],null!=e.equals){if(!e.equals(t.children[i],n))return!1}else if(e!==t.children[i])return!1;return!0},a.prototype.simplify=function(t){var n,e,i,r,o,s,h,c,f,p,d,y,g,m,v,b,w,M,T,x,L,S,V,A,C,q,E,j,_,k;for(null==t&&(t={get:function(t){return[t]}}),g=[],j=this.children,b=0,x=j.length;x>b;b++)e=j[b],null!=e.simplify?e=e.simplify(t):null!=e.copy&&(e=e.copy()),g.push(e);for(f=[],i=null,s=0;s<g.length;){if(y=g[s],y instanceof a){for(g.splice(s,1)[0],_=y.children,w=0,L=_.length;L>w;w++)n=_[w],g.push(n);s-=1}else if(y instanceof l.Constant)i=null!=i?i.add(y):y.copy();else if(y instanceof u){for(r=null,m=null,k=y.children,M=0,S=k.length;S>M;M++)e=k[M],e instanceof l.Constant?r=null!=r?r.multiply(e):e.copy():null!=m?m.children.push(e):m=new u(e);if(1===m.children.length&&(m=m.children[0]),null!=r&&null==m)i=null!=i?i.add(r):r.copy();else{for(null==r&&(r=new l.Constant("1")),o=!1,h=T=0,V=f.length;V>T;h=++T)c=f[h],null!=c[0].equals?c[0].equals(m,t)&&(f[h][1]=new a(c[1],r),f[h][1]=f[h][1].simplify(t),o=!0):c[0]===m&&(f[h][1]=new a(c[1],r),f[h][1]=f[h][1].simplify(t),o=!0);o||f.push([m,r])}}else{for(o=!1,h=q=0,A=f.length;A>q;h=++q)c=f[h],null!=c[0].equals?c[0].equals(y,t)&&(f[h][1]=new a(c[1],new l.Constant("1")),f[h][1]=f[h][1].simplify(t),o=!0):c[0]===y&&(f[h][1]=new a(c[1],new l.Constant("1")),f[h][1]=f[h][1].simplify(t),o=!0);o||f.push([y,new l.Constant("1")])}s+=1}for(p=null,E=0,C=f.length;C>E;E++)c=f[E],null!=c[0].children&&1===c[0].children.length&&(c[0]=c[0].children[0]),1!==("function"==typeof(v=c[1]).evaluate?v.evaluate():void 0)?(d=new u(c[0],c[1]),d=d.simplify(t)):d=c[0],null!=p?p.children.push(d):p=new a(d);return null==p?i:(null!=i&&0!==i.evaluate()&&p.children.push(i),p.sort(),1!==p.children.length?p:p.children[0])},a.prototype.expandAndSimplify=function(t){var n;return n=this.expand(),null!=n.simplify?n.simplify(t):n},a.prototype.solve=function(t,n){var e,i,o,c,f,p,d,y,g,m,v,b,w,M,T,x,L,S,V,A,C,q,E,j,_,k,O,H,N,I,X,P,B,z,$,F,Z,R,U,G,Q,D,J,K,W,Y,tn,nn,en,rn,ln,on,an,sn,un,hn,cn;if(null==n&&(n=null),g=this.expandAndSimplify(n),null==n&&(n={get:function(t){return[t]}}),B=[],z=[],g instanceof l.Terminal){if(g instanceof l.Variable&&(g.label===t||(tn=g.label,r.call(n.get(t),tn)>=0)))return[new l.Constant("0")];throw new s(g.toString(),t)}if(!(g instanceof a))return g.solve(t,n);for(nn=g.children,Z=0,Q=nn.length;Q>Z;Z++)if(P=nn[Z],null!=P.copy&&(P=P.copy()),P instanceof h)P.children.left instanceof l.Variable&&(P.children.left.label===t||(rn=P.children.left.label,r.call(n.get(t),rn)>=0))?B.push(P):z.push(P);else if(P instanceof u){for(c=!1,ln=P.children,R=0,D=ln.length;D>R;R++){if(I=ln[R],I instanceof l.Variable&&(I.label===t||(on=I.label,r.call(n.get(t),on)>=0))){B.push(P),c=!0;break}if(I instanceof h&&I.children.left instanceof l.Variable&&(I.children.left.label===t||(an=I.children.left.label,r.call(n.get(t),an)>=0))){B.push(P),c=!0;break}}c||z.push(P)}else P instanceof l.Variable&&(P.label===t||(sn=P.label,r.call(n.get(t),sn)>=0))?B.push(P):z.push(P);if(0===B.length)throw new s(g.toString(),t);for(m=[],b=[],L=[],V=[],U=0,J=B.length;J>U;U++)if(P=B[U],P instanceof l.Variable)m.push(new l.Constant("1"));else if(P instanceof h){if(!(P.children.right instanceof l.Constant))throw new s(g.toString(),t);if(O=P.children.right.evaluate(),!(P.children.left instanceof l.Variable&&(P.children.left.label===t||(un=P.children.left.label,r.call(n.get(t),un)>=0))))throw new s(g.toString(),t," (this shouldn't happen)");if(1===O)m.push(new l.Constant("1"));else if(2===O)b.push(new l.Constant("1"));else if(-1===O)L.push(new l.Constant("1"));else{if(-2!==O)throw new s(g.toString(),t," (not supported)");V.push(new l.Constant("1"))}}else if(P instanceof u){for(X=[],H=!1,T=!1,x=!1,hn=P.children,G=0,K=hn.length;K>G;G++)if(I=hn[G],I instanceof l.Variable&&(I.label===t||(cn=I.label,r.call(n.get(t),cn)>=0)));else if(I instanceof h){if(!(I.children.right instanceof l.Constant))throw new s(g.toString(),t);if(O=I.children.right.evaluate(),I.children.left instanceof l.Variable&&(I.children.left.label===t||(en=I.children.left.label,r.call(n.get(t),en)>=0)))if(1===O);else if(2===O)H=!0;else if(-1===O)T=!0;else{if(-2!==O)throw new s(g.toString(),t," (not supported)");x=!0}else X.push(I)}else X.push(I);M=X.length>0?function(t,n,e){e.prototype=t.prototype;var i=new e,r=t.apply(i,n);return Object(r)===r?r:i}(u,X,function(){}):new l.Constant("1"),H?b.push(M):T?L.push(M):x?V.push(M):m.push(M)}for(C=[],Y=0,W=z.length;W>Y;Y++)P=z[Y],j=new u("-1",null!=P.copy?P.copy():P),j=j.simplify(n),C.push(j);if(0!==C.length&&(q=function(t,n,e){e.prototype=t.prototype;var i=new e,r=t.apply(i,n);return Object(r)===r?r:i}(a,C,function(){})),0!==z.length&&(k=function(t,n,e){e.prototype=t.prototype;var i=new e,r=t.apply(i,n);return Object(r)===r?r:i}(a,z,function(){})),0!==m.length&&(v=function(t,n,e){e.prototype=t.prototype;var i=new e,r=t.apply(i,n);return Object(r)===r?r:i}(a,m,function(){})),0!==b.length&&(w=function(t,n,e){e.prototype=t.prototype;var i=new e,r=t.apply(i,n);return Object(r)===r?r:i}(a,b,function(){})),0!==L.length&&(S=function(t,n,e){e.prototype=t.prototype;var i=new e,r=t.apply(i,n);return Object(r)===r?r:i}(a,L,function(){})),0!==V.length&&(A=function(t,n,e){e.prototype=t.prototype;var i=new e,r=t.apply(i,n);return Object(r)===r?r:i}(a,V,function(){})),0===C.length&&(q=new l.Constant("0")),0===b.length){if(0===m.length){if(0===L.length){if(0===V.length)throw new s(g.toString(),t);return f=new u(new h(A,"1/2"),new h(q,"-1/2")),i=new u(-1,f.copy()),i=i.expandAndSimplify(n),o=f.expandAndSimplify(n),("function"==typeof i.equals?i.equals(o):void 0)?[i]:[i,o]}return 0===V.length?(f=new u(S,new h(q,"-1")),[f.expandAndSimplify(n)]):(E=new a(new u(k,new h(new l.Variable(t),2)),new u(S,new l.Variable(t)),A),E.solve(t,n))}if(0===L.length){if(0===V.length)return f=new u(q,new h(v,"-1")),[f.expandAndSimplify(n)];throw new s(g.toString(),t," (not supported)")}throw new s(g.toString(),t," (not supported)")}if(0===m.length){if(0===L.length){if(0===V.length)return f=new h(new u(q,new h(w,"-1")),"1/2"),i=new u("-1",f.copy()),i=i.expandAndSimplify(n),o=f.expandAndSimplify(n),("function"==typeof i.equals?i.equals(o):void 0)?[i]:[i,o];throw new s(g.toString(),t," (not supported)")}throw new s(g.toString(),t," (not supported)")}if(L.length>0||V.length>0)throw new s(g.toString(),t," (not supported)");return null!=k?(e=w,p=v,d=k,y=new a(new h(p,"2"),new u("-4",e,d)),N=new h(y,"1/2"),$=new u(new a(new u("-1",p),N),new h(new u("2",e),"-1")),F=new u("-1",new a(p,N),new h(new u("2",e),"-1")),$=$.expandAndSimplify(n),F=F.expandAndSimplify(n),null!=$.equals&&$.equals(F)?[$]:[$,F]):(_=new h(w,"-1"),j=new u("-1",v,_),j=j.simplify(n),[0,j])},a.prototype.getAllVariables=function(){var t,n,e,i,r,o,a,s,u,h;for(r={},h=this.children,o=0,s=h.length;s>o;o++)if(t=h[o],t instanceof l.Variable)r[t.label]=!0;else if(null!=t.getAllVariables)for(n=t.getAllVariables(),a=0,u=n.length;u>a;a++)i=n[a],r[i]=!0;e=[];for(i in r)e.push(i);return e},a.prototype.replaceVariables=function(t){var n,e,i,r,o,a;for(o=this.children,a=[],e=i=0,r=o.length;r>i;e=++i)n=o[e],n instanceof l.Variable&&n.label in t?a.push(this.children[e].label=t[n.label]):null!=n.replaceVariables?a.push(n.replaceVariables(t)):a.push(void 0);return a},a.prototype.sub=function(n,e){var i,r,o,s,u,h,c;null==e&&(e=null);for(s in n)n[s]instanceof l.Terminal||n[s]instanceof t.BasicNode||(n[s]=new l.Constant(n[s]));for(r=[],c=this.children,u=0,h=c.length;h>u;u++)i=c[u],i instanceof l.Variable&&i.label in n?r.push(n[i.label].copy()):null!=i.sub?r.push(i.sub(n)):r.push(i.copy());return o=function(t,n,e){e.prototype=t.prototype;var i=new e,r=t.apply(i,n);return Object(r)===r?r:i}(a,r,function(){}),o=o.expandAndSimplify(e)},a.prototype.substituteExpression=function(t,n,e,i){var o,s,u,h,c,f,p,d;for(null==e&&(e=null),null==i&&(i=!1),i&&(t=t.solve(n,e)[0]),null==e&&(e={get:function(t){return[t]}}),h=e.get(n),s=[],p=this.children,c=0,f=p.length;f>c;c++)o=p[c],o instanceof l.Variable&&(o.label===n||(d=o.label,r.call(h,d)>=0))?s.push(t.copy()):null!=o.substituteExpression?s.push(o.substituteExpression(t,n,e)):s.push(o.copy());return u=function(t,n,e){e.prototype=t.prototype;var i=new e,r=t.apply(i,n);return Object(r)===r?r:i}(a,s,function(){}),console.log(u.toString()),u.expandAndSimplify(e)},a.prototype.toMathML=function(t,n,e,i){var r,l,a,s,u;return null==n&&(n=!1),null==e&&(e="0"),null==i&&(i=!1),u=o.getMathMLInfo(t,n,e),a=u[0],s=u[1],l=u[2],i?r="</math></div>":(l="",r=""),l+"<mrow>"+this.children.map(function(e){return e.toMathML(t,n)}).join("<mo>+</mo>")+"</mrow>"+r},a.prototype.toHTML=function(t,n,e,i){var r,l,a,s,u;return null==n&&(n=!1),null==e&&(e="0"),null==i&&(i=!1),u=o.getHTMLInfo(t,n,e),a=u[0],s=u[1],l=u[2],i?r="</div>":(l="",r=""),l+this.children.map(function(t){return t.toHTML()}).join("+")+r},a.prototype.toLaTeX=function(){return this.children.map(function(t){return t.toLaTeX()}).join("+")},a}(t.RoseNode),u=function(e){function u(){var t;if(t=1<=arguments.length?i.call(arguments,0):[],t.length<1)throw new Error("Mul nodes must have at least one child.");this.cmp=-2,t=f.apply(null,t),u.__super__.constructor.call(this,"*",t)}return n(u,e),u.prototype.copy=function(){var t,n;return t=function(){var t,e,i,r;for(i=this.children,r=[],t=0,e=i.length;e>t;t++)n=i[t],r.push(null!=n.copy?n.copy():n);return r}.call(this),function(t,n,e){e.prototype=t.prototype;var i=new e,r=t.apply(i,n);return Object(r)===r?r:i}(u,t,function(){})},u.prototype.simplifyConstants=function(){var t,n,e,i,r,o;for(n=new l.Constant("1"),e=null,o=this.children,i=0,r=o.length;r>i;i++)t=o[i],t instanceof l.Constant?n=n.multiply(t):null!=e?e.children.push(t):e=new u(t);return null==e?n:1===n.evaluate()?e:new u(n,e)},u.prototype.compareSameType=function(t){var n,e,i,r,l,o,a;for(r=this.children.length===t.children.length?0:this.children.length<t.children.length?-1:1,a=this.children,i=l=0,o=a.length;o>l;i=++l){if(e=a[i],null==t.children[i])return 1;if(n=c(this.children[i],t.children[i]),0!==n)return n}return r},u.expandMulAdd=function(t,n){var e,i,r,l,o,s,h,c,f,p,d;for(o=[],p=n.children,s=0,c=p.length;c>s;s++){if(i=p[s],null!=i.copy&&(i=i.copy()),i instanceof u)for(l=t.copy(),d=i.children,h=0,f=d.length;f>h;h++)e=d[h],l.children.push(e);else i instanceof a?l=u.expandMulAdd(t,i):1===t.children.length?(l=t.copy(),l.children.push(i.copy())):l=new u(t.copy(),i.copy());o.push(l)}return r=function(t,n,e){e.prototype=t.prototype;var i=new e,r=t.apply(i,n);return Object(r)===r?r:i}(a,o,function(){}),r=r.expand()},u.prototype.equals=function(t,n){var e,i,r,l,o;if(!(t instanceof u))return!1;if(t.children.length!==this.children.length)return!1;for(o=this.children,i=r=0,l=o.length;l>r;i=++r)if(e=o[i],null!=e.equals){if(!e.equals(t.children[i],n))return!1}else if(e!==t.children[i])return!1;return!0},u.prototype.expand=function(){var t,n,e,i,r,l,o,s,h,c,f,p,d,y;for(i=[],p=this.children,l=0,h=p.length;h>l;l++)t=p[l],null!=t.expand?t=t.expand():null!=t.copy&&(t=t.copy()),i.push(t);for(;i.length>1;)if(i[0]instanceof u)if(i[1]instanceof a)i[0]=u.expandMulAdd(i[0],i.splice(1,1)[0]);else if(i[1]instanceof u)for(d=i.splice(1,1)[0].children,o=0,c=d.length;c>o;o++)t=d[o],i[0].children.push(t);else i[0].children.push(i.splice(1,1)[0]);else if(i[0]instanceof a)if(i[1]instanceof a){for(e=[],y=i[0].children,s=0,f=y.length;f>s;s++)t=y[s],n=new u(t,i[1]),n=n.expand(),e.push(n);i.splice(1,1),i[0]=function(t,n,e){e.prototype=t.prototype;var i=new e,r=t.apply(i,n);return Object(r)===r?r:i}(a,e,function(){}),i[0]=i[0].expand()}else i[0]=i[1]instanceof u?u.expandMulAdd(i.splice(1,1)[0],i[0]):new u(i[0],i.splice(1,1)[0]);else i[0]=new u(i[0]);return"function"==typeof(r=i[0]).sort&&r.sort(),i[0]},u.prototype.simplify=function(t){var n,e,i,r,o,s,c,f,p,d,y,g,m,v,b,w,M,T,x,L,S,V,A,C,q,E,j,_,k,O,H,N,I,X,P;for(null==t&&(t={get:function(t){return[t]}}),b=[],k=this.children,M=0,S=k.length;S>M;M++)i=k[M],null!=i.simplify?i=i.simplify(t):null!=i.copy&&(i=i.copy()),b.push(i);for(p=[],r=null,s=0;s<b.length;){if(v=b[s],v instanceof u){for(i=b.splice(s,1)[0],O=i.children,T=0,V=O.length;V>T;T++)e=O[T],b.push(e);s-=1}else if(v instanceof l.Constant)r=null!=r?r.multiply(v):v.copy();else if(v instanceof h){for(n=v.children.left,m=v.children.right,o=!1,c=x=0,A=p.length;A>x;c=++x)f=p[c],null!=f[0].equals?f[0].equals(n,t)&&(p[c][1]=new a(f[1],m),p[c][1]=p[c][1].simplify(t),1===(null!=(H=p[c][1].children)?H.length:void 0)&&(p[c][1]=p[c][1].children[0]),o=!0):f[0]===n&&(p[c][1]=new a(f[1],m),p[c][1]=p[c][1].simplify(t),1===(null!=(N=p[c][1].children)?N.length:void 0)&&(p[c][1]=p[c][1].children[0]),o=!0);o||p.push([n,m])}else{for(o=!1,c=L=0,C=p.length;C>L;c=++L)f=p[c],null!=f[0].equals?f[0].equals(v,t)&&(p[c][1]=new a(f[1],new l.Constant("1")),p[c][1]=p[c][1].simplify(t),1===(null!=(I=p[c][1].children)?I.length:void 0)&&(p[c][1]=p[c][1].children[0]),o=!0):f[0]===v&&(p[c][1]=new a(f[1],new l.Constant("1")),p[c][1]=p[c][1].simplify(t),1===(null!=(X=p[c][1].children)?X.length:void 0)&&(p[c][1]=p[c][1].children[0]),o=!0);o||p.push([v,new l.Constant("1")])}s+=1}if(0===(null!=r?"function"==typeof r.evaluate?r.evaluate():void 0:void 0))return new l.Constant("0");for(d=null,j=0,q=p.length;q>j;j++)f=p[j],1!==("function"==typeof(w=f[1]).evaluate?w.evaluate():void 0)?(y=new h(f[0],f[1]),y=y.simplify(t)):y=f[0],null!=d?d.children.push(y):d=new u(y);if(null==d)return r;for(null!=r&&1!==r.evaluate()&&d.children.push(r),d.sort(),g=!0,P=d.children,_=0,E=P.length;E>_;_++)if(i=P[_],!(i instanceof l.Constant)){g=!1;break}return g?d.simplifyConstants():1!==d.children.length?d:d.children[0]},u.prototype.sort=function(){var t,n,e,i;for(i=this.children,n=0,e=i.length;e>n;n++)t=i[n],"function"==typeof t.sort&&t.sort();return this.children.sort(c)},u.prototype.expandAndSimplify=function(t){var n;return n=this.expand(),null!=n.simplify?n.simplify(t):n},u.prototype.solve=function(t,n){var e,i,o,a,c,f,p,d;if(null==n&&(n=null),o=this.expandAndSimplify(n),null==n&&(n={get:function(t){return[t]}}),o instanceof l.Terminal){if(o instanceof l.Variable&&(o.label===t||(f=o.label,r.call(n.get(t),f)>=0)))return[new l.Constant("0")];throw new s(o.toString(),t)}if(!(o instanceof u))return o.solve(t,n);for(p=o.children,a=0,c=p.length;c>a;a++){if(e=p[a],e instanceof l.Variable&&(e.label===t||(d=e.label,r.call(n.get(t),d)>=0)))return[new l.Constant("0")];if(e instanceof h)try{return e.solve(t,n)}catch(y){if(i=y,i instanceof s)continue;throw i}}throw new s(o.toString(),t)},u.prototype.getAllVariables=function(){var t,n,e,i,r,o,a,s,u,h;for(r={},h=this.children,o=0,s=h.length;s>o;o++)if(t=h[o],t instanceof l.Variable)r[t.label]=!0;else if(null!=t.getAllVariables)for(n=t.getAllVariables(),a=0,u=n.length;u>a;a++)i=n[a],r[i]=!0;e=[];for(i in r)e.push(i);return e},u.prototype.replaceVariables=function(t){var n,e,i,r,o,a;for(o=this.children,a=[],e=i=0,r=o.length;r>i;e=++i)n=o[e],n instanceof l.Variable&&n.label in t?a.push(this.children[e].label=t[n.label]):null!=n.replaceVariables?a.push(n.replaceVariables(t)):a.push(void 0);return a},u.prototype.sub=function(n,e){var i,r,o,a,s,h,c;null==e&&(e=null);for(a in n)n[a]instanceof l.Terminal||n[a]instanceof t.BasicNode||(n[a]=new l.Constant(n[a]));for(r=[],c=this.children,s=0,h=c.length;h>s;s++)i=c[s],i instanceof l.Variable&&i.label in n?r.push(n[i.label].copy()):null!=i.sub?r.push(i.sub(n)):r.push(i.copy());return o=function(t,n,e){e.prototype=t.prototype;var i=new e,r=t.apply(i,n);return Object(r)===r?r:i}(u,r,function(){}),o=o.expandAndSimplify(e)},u.prototype.substituteExpression=function(t,n,e,i){var o,a,s,h,c,f,p,d;for(null==e&&(e=null),null==i&&(i=!1),i&&(t=t.solve(n,e)[0]),null==e&&(e={get:function(t){return[t]}}),h=e.get(n),a=[],p=this.children,c=0,f=p.length;f>c;c++)o=p[c],o instanceof l.Variable&&(o.label===n||(d=o.label,r.call(h,d)>=0))?a.push(t.copy()):null!=o.substituteExpression?a.push(o.substituteExpression(t,n,e)):a.push(o.copy());return s=function(t,n,e){e.prototype=t.prototype;var i=new e,r=t.apply(i,n);return Object(r)===r?r:i}(u,a,function(){}),s.expandAndSimplify(e)},u.prototype.toMathML=function(t,n,e,i){var r,s,u,c,f,p,d,y,g,m,v,b;if(null==n&&(n=!1),null==e&&(e="0"),null==i&&(i=!1),b=o.getMathMLInfo(t,n,e),d=b[0],y=b[1],f=b[2],i?s="</math></div>":(f="",s=""),u=function(){var t,n,e,i;
for(e=this.children,i=[],t=0,n=e.length;n>t;t++)r=e[t],r instanceof h&&null!=r.children.right.evaluate&&r.children.right.evaluate()<0&&i.push(new h(r,"-1").simplify());return i}.call(this),m=function(){var t,n,e,i;for(e=this.children,i=[],t=0,n=e.length;n>t;t++)r=e[t],r instanceof h&&null!=r.children.right.evaluate&&r.children.right.evaluate()<0||i.push(r);return i}.call(this),v=m.filter(function(t){return!(t instanceof l.Constant&&-1===("function"==typeof t.evaluate?t.evaluate():void 0))}),c=u.filter(function(t){return!(t instanceof l.Constant&&-1===("function"==typeof t.evaluate?t.evaluate():void 0))}),u.length>0&&m.length>0)return g=u.length-c.length+m.length-v.length,f+function(){var t,n;for(n=[],p=t=0;g>=0?g>t:t>g;p=g>=0?++t:--t)n.push("<mo>-</mo>");return n}().join("")+"<mfrac><mrow>"+v.map(function(e){return e instanceof a?"<mfenced>"+e.toMathML(t,n)+"</mfenced>":e.toMathML(t,n)}).join("<mo>&middot;</mo>")+"</mrow><mrow>"+c.map(function(e){return e instanceof a?"<mfenced>"+e.toMathML(t,n)+"</mfenced>":e.toMathML(t,n)}).join("<mo>&middot;</mo>")+"</mrow></mfrac>"+s;if(u.length>0)return f+function(){var t,n;for(n=[],p=t=0;g>=0?g>t:t>g;p=g>=0?++t:--t)n.push("<mo>-</mo>");return n}().join("")+"<mfrac><mn>1</mn><mrow>"+c.map(function(e){return e instanceof a?"<mfenced>"+e.toMathML(t,n)+"</mfenced>":e.toMathML(t,n)}).join("<mo>&middot;</mo>")+"</mrow></mfrac>"+s;if(m.length>0)return f+function(){var t,n;for(n=[],p=t=0;g>=0?g>t:t>g;p=g>=0?++t:--t)n.push("<mo>-</mo>");return n}().join("")+"<mrow>"+v.map(function(e){return e instanceof a?"<mfenced>"+e.toMathML(t,n)+"</mfenced>":e.toMathML(t,n)}).join("<mo>&middot;</mo>")+"</mrow>"+s;throw new Error("No terms in Mul node.")},u.prototype.toHTML=function(t,n,e,i){var r,l,s,u,h;return null==n&&(n=!1),null==e&&(e="0"),null==i&&(i=!1),h=o.getHTMLInfo(t,n,e),s=h[0],u=h[1],l=h[2],i?r="</div>":(l="",r=""),l+this.children.map(function(t){return t instanceof a?"("+t.toHTML()+")":t.toHTML()}).join("&middot;")+r},u.prototype.toLaTeX=function(){return this.children.map(function(t){return t instanceof a?"\\left("+t.toLaTeX()+"\\right)":t.toLaTeX()}).join("\\cdot")},u}(t.RoseNode),h=function(e){function h(){var t,n,e,r;if(n=arguments[0],e=arguments[1],t=3<=arguments.length?i.call(arguments,2):[],null==n||null==e)throw new Error("Pow nodes must have two children.");if(t.length>0)throw new Error("Pow nodes must have two children.");this.cmp=-3,r=f(n,e),n=r[0],e=r[1],h.__super__.constructor.call(this,"**",n,e)}return n(h,e),h.prototype.copy=function(){return new h(null!=this.children.left.copy?this.children.left.copy():this.children.left,null!=this.children.right.copy?this.children.right.copy():this.children.right)},h.prototype.sort=function(){var t,n;return"function"==typeof(t=this.children.left).sort&&t.sort(),"function"==typeof(n=this.children.right).sort?n.sort():void 0},h.prototype.equals=function(t,n){if(!(t instanceof h))return!1;if(null!=this.children.left.equals){if(!this.children.left.equals(t.children.left,n))return!1}else if(this.children.left!==t.children.left)return!1;if(null!=this.children.right.equals){if(!this.children.right.equals(t.children.right,n))return!1}else if(this.children.right!==t.children.right)return!1;return!0},h.prototype.compareSameType=function(t){var n;return n=c(this.children.left,t.children.left),0!==n?n:c(this.children.right,t.children.right)},h.prototype.expand=function(){var t,n,e,i,r,o,s,c,f,p,d,y,g;if(r=null!=this.children.left.expand?this.children.left.expand():null!=this.children.left.copy?this.children.left.copy():this.children.left,c=null!=this.children.right.expand?this.children.right.expand():null!=this.children.right.copy?this.children.right.copy():this.children.right,null!=r.children){if(r instanceof h)r.children.right=new u(r.children.right,c),r.expand();else if(r instanceof u)for(y=r.children,i=f=0,d=y.length;d>f;i=++f)t=y[i],s=new h(t,c),s=s.expand(),r.children[i]=s;else if(r instanceof a)if(c instanceof l.Constant&&0===c.evaluate()%1&&c.evaluate()>0){for(n=[],e=p=1,g=c.evaluate();g>=1?g>=p:p>=g;e=g>=1?++p:--p)n.push(r);o=function(t,n,e){e.prototype=t.prototype;var i=new e,r=t.apply(i,n);return Object(r)===r?r:i}(u,n,function(){}),o=o.expand(),r=o}else r=new h(r,c);return r}return new h(r,c)},h.prototype.simplify=function(t){var n,e,i,r;return null==t&&(t={get:function(t){return[t]}}),n=null!=this.children.left.simplify?this.children.left.simplify(t):null!=this.children.left.copy?this.children.left.copy():this.children.left,r=null!=this.children.right.simplify?this.children.right.simplify(t):null!=this.children.right.copy?this.children.right.copy():this.children.right,1===("function"==typeof r.evaluate?r.evaluate():void 0)?n:1===("function"==typeof n.evaluate?n.evaluate():void 0)?n:0===("function"==typeof r.evaluate?r.evaluate():void 0)?new l.Constant("1"):r instanceof l.Constant&&n instanceof l.Constant?new l.Constant(Math.pow(n.evaluate(),r.evaluate())):n instanceof h?(i=new u(n.children.right,r),e=new h(n.children.left,i),e=e.simplify(t)):new h(n,r)},h.prototype.expandAndSimplify=function(t){var n;return n=this.expand(),null!=n.simplify?n.simplify(t):n},h.prototype.solve=function(t,n){var e,i,o,a,c,f,p,d,y,g;if(null==n&&(n={get:function(t){return[t]}}),i=this.expandAndSimplify(n),i instanceof l.Terminal){if(i instanceof l.Variable&&(i.label===t||(y=i.label,r.call(n.get(t),y)>=0)))return[new l.Constant("0")];throw new s(i.toString(),t)}if(i instanceof h){if(i.children.left instanceof l.Variable){if(i.children.left.label===t||(g=i.children.left.label,r.call(n.get(t),g)>=0))return[new l.Constant("0")];throw new s(i.toString(),t)}if(i.children.left instanceof l.Terminal)throw new s(i.toString(),t);try{f=i.children.left.solve(t,n)}catch(m){throw e=m}if(null!=i.children.right.evaluate&&0===i.children.right.evaluate()%2){for(a=[],p=0,d=f.length;d>p;p++)c=f[p],o=new u(-1,c).simplify(n),null!=o.equals?(o.equals(c)||a.push(o),a.push(c)):(o!==c&&a.push(o),a.push(c));return a}return f}return i.solve(t,n)},h.prototype.sub=function(n,e){var i,r,o,a;null==e&&(e=null);for(a in n)n[a]instanceof l.Terminal||n[a]instanceof t.BasicNode||(n[a]=new l.Constant(n[a]));return i=null,o=null,i=this.children.left instanceof l.Variable&&this.children.left.label in n?n[this.children.left.label].copy():null!=this.children.left.sub?this.children.left.sub(n):this.children.left.copy(),o=this.children.right instanceof l.Variable&&this.children.right.label in n?n[this.children.right.label].copy():null!=this.children.right.sub?this.children.right.sub(n):this.children.right.copy(),r=new h(i,o),r=r.expandAndSimplify(e)},h.prototype.getAllVariables=function(){var t,n,e,i,r,o,a,s,u;if(r={},this.children.left instanceof l.Variable)r[this.children.left.label]=!0;else if(null!=this.children.left.getAllVariables)for(t=this.children.left.getAllVariables(),o=0,s=t.length;s>o;o++)i=t[o],r[i]=!0;if(this.children.right instanceof l.Variable)r[this.children.right.label]=!0;else if(null!=this.children.right.getAllVariables)for(e=this.children.right.getAllVariables(),a=0,u=e.length;u>a;a++)i=e[a],r[i]=!0;n=[];for(i in r)n.push(i);return n},h.prototype.replaceVariables=function(t){return this.children.left instanceof l.Variable&&this.children.left.label in t?this.children.left.label=t[this.children.left.label]:null!=this.children.left.replaceVariables&&this.children.left.replaceVariables(t),this.children.right instanceof l.Variable&&this.children.right.label in t?this.children.right.label=t[this.children.right.label]:null!=this.children.right.replaceVariables?this.children.right.replaceVariables(t):void 0},h.prototype.substituteExpression=function(t,n,e,i){var o,a,s,u,c,f;return null==e&&(e=null),null==i&&(i=!1),i&&(t=t.solve(n,e)[0]),null==e&&(e={get:function(t){return[t]}}),u=e.get(n),o=this.children.left.copy(),s=this.children.right.copy(),this.children.left instanceof l.Variable&&(this.children.left.label===n||(c=this.children.left.label,r.call(u,c)>=0))?o=t.copy():this.children.left instanceof l.Terminal||(o=this.children.left.substituteExpression(t,n,e)),this.children.right instanceof l.Variable&&(this.children.right.label===n||(f=this.children.right.label,r.call(u,f)>=0))?s=t.copy():this.children.right instanceof l.Terminal||(s=this.children.right.substituteExpression(t,n,e)),a=new h(o,s),a=a.expandAndSimplify(e)},h.prototype.toMathML=function(t,n,e,i){var r,l,s,h,c,f,p,d,y,g,m;return null==n&&(n=!1),null==e&&(e="0"),null==i&&(i=!1),m=o.getMathMLInfo(t,n,e),h=m[0],c=m[1],l=m[2],i?r="</math></div>":(l="",r=""),1===("function"==typeof(p=this.children.right).evaluate?p.evaluate():void 0)?l+this.children.left.toMathML(t,n)+r:0===("function"==typeof(d=this.children.right).evaluate?d.evaluate():void 0)?l+"<mn>1</mn>"+r:(("function"==typeof(y=this.children.right).evaluate?y.evaluate():void 0)<0?(f=this.children.right.copy(),f=new u("-1",f),f=f.expandAndSimplify()):f=this.children.right.copy(),s=this.children.left instanceof a||this.children.left instanceof u?"<mfenced>"+this.children.left.toMathML(t,n)+"</mfenced>":""+this.children.left.toMathML(t,n),1!==("function"==typeof f.evaluate?f.evaluate():void 0)&&(s="<msup>"+s+f.toMathML(t,n)+"</msup>"),("function"==typeof(g=this.children.right).evaluate?g.evaluate():void 0)<0&&(s="<mfrac><mn>1</mn>"+s+"</mfrac>"),l+s+r)},h.prototype.toHTML=function(t,n,e,i){var r,a,s,u,h,c,f,p,d,y;return null==n&&(n=!1),null==e&&(e="0"),null==i&&(i=!1),y=o.getHTMLInfo(t,n,e),h=y[0],c=y[1],a=y[2],i?r="</div>":(a="",r=""),1===("function"==typeof(p=this.children.right).evaluate?p.evaluate():void 0)?a+this.children.left.toHTML()+r:0===("function"==typeof(d=this.children.right).evaluate?d.evaluate():void 0)?a+"1"+r:(u=this.children.left instanceof l.Terminal?this.children.left.toHTML():"("+this.children.left.toHTML()+")",f=this.children.right instanceof l.Terminal?this.children.right.toHTML():"("+this.children.right.toHTML()+")",s=""+u+" ** "+f,a+s+r)},h.prototype.toLaTeX=function(){var t,n,e,i,r;return 1===("function"==typeof(e=this.children.right).evaluate?e.evaluate():void 0)?this.children.left.toLaTeX():0===("function"==typeof(i=this.children.right).evaluate?i.evaluate():void 0)?"1":(t=this.children.left instanceof a||this.children.left instanceof u?"\\left("+this.children.left.toLaTeX()+"\\right)^{"+this.children.right.toLaTeX()+"}":""+this.children.left.toLaTeX()+"^{"+this.children.right.toLaTeX()+"}",("function"==typeof(r=this.children.right).evaluate?r.evaluate():void 0)<0&&(n=this.children.right.copy(),n=new u("-1",n),n=n.simplify(),t="\\frac{1}{"+t+"}"),t)},h}(t.BinaryNode),c=function(t,n){return null!=t.cmp&&null!=n.cmp?t.cmp===n.cmp?t.compareSameType(n):(t.cmp-n.cmp)/Math.abs(t.cmp-n.cmp):0},{Add:a,Mul:u,Pow:h,compare:c,AlgebraError:s}})}.call(this),function(){var t=[].slice,n=[].indexOf||function(t){for(var n=0,e=this.length;e>n;n++)if(n in this&&this[n]===t)return n;return-1};e("Equation",["terminals","nodes","operators","parse"],function(e,i,r,l){var o;return o=function(){function o(){var n,r;switch(n=1<=arguments.length?t.call(arguments,0):[],n.length){case 1:if(n[0]instanceof String||"string"==typeof n[0])switch(r=n[0].split("="),r.length){case 1:this.left=new e.Constant("0"),this.right=l.stringToExpression(r[0]),this.right=this.right.simplify();break;case 2:this.left=l.stringToTerminal(r[0]),this.right=l.stringToExpression(r[1]),this.right=this.right.simplify();break;default:throw new Error("Too many '=' signs.")}else{if(!(n[0]instanceof e.Terminal||n[0]instanceof i.BasicNode))throw new Error("Argument "+n[0]+" must be a String, Terminal, or Node.");this.left=new e.Constant("0"),this.right=n[0].copy()}break;case 2:if(n[0]instanceof String||"string"==typeof n[0])this.left=l.stringToTerminal(n[0]);else{if(!(n[0]instanceof e.Terminal||n[0]instanceof i.BasicNode))throw new Error("Argument "+n[0]+" must be a String, Terminal, or Node.");this.left=n[0].copy()}if(n[1]instanceof String||"string"==typeof n[1])this.right=l.stringToExpression(n[1]),this.right=this.right.simplify();else{if(!(n[1]instanceof e.Terminal||n[1]instanceof i.BasicNode))throw new Error("Argument "+n[1]+" must be a String, Terminal, or Node.");this.right=n[1].copy()}break;default:throw new Error("Too many arguments.")}}return o.prototype.solve=function(t,n){var e,i;return null==n&&(n=null),e=new r.Add(this.right,new r.Mul("-1",this.left)),i=e.solve(t,n),i.map(function(n){return new o(t,n)})},o.prototype.replaceVariables=function(t){return this.left.replaceVariables(t),this.right.replaceVariables(t)},o.prototype.getAllVariables=function(){var t,e,i,r,l;for(t=this.left.getAllVariables(),e=this.right.getAllVariables(),r=0,l=t.length;l>r;r++)i=t[r],n.call(e,i)<0&&e.unshift(i);return e},o.prototype.sub=function(t){var n;return this.left instanceof e.Variable&&this.left.label in t?(n=new r.Add(this.right,new r.Mul("-1",this.left)),new o(n.sub(t))):new o(this.left,this.right.sub(t))},o.prototype.substituteExpression=function(t,i,l,a){var s,u,h;return null==a&&(a=!1),t instanceof o&&(t=new r.Add(t.right,new r.Mul("-1",t.left))),null==l&&(l={get:function(t){return[t]}}),u=l.get(i),a&&(t=t.solve(i,l)[0]),this.left instanceof e.Variable&&(this.left.label===i||(h=this.left.label,n.call(u,h)>=0))?(s=new r.Add(this.right,new r.Mul("-1",this.left)),new o(s.substituteExpression(t,i,l))):new o(this.left,this.right.substituteExpression(t,i,l).expandAndSimplify(l))},o.prototype.toMathML=function(t,n,e,i){return null==n&&(n=!1),null==e&&(e=null),null==i&&(i=!1),this.right.toMathML(t,n,this.left,i)},o.prototype.toHTML=function(t,n,e,i){return null==n&&(n=!1),null==e&&(e=null),null==i&&(i=!1),this.right.toHTML(t,n,this.left,i)},o.prototype.toLaTeX=function(){return""+this.left.toLaTeX()+" = "+this.right.toLaTeX()},o.prototype.toString=function(){return""+this.left+" = "+this.right},o}()})}.call(this),function(){n.config({baseUrl:"./"}),e("coffeequate",["Equation","operators","terminals","parse"],function(t,n,e,i){return{Equation:t,tree:{operators:n,terminals:e},parse:i}})}.call(this),n(["coffeequate"]),n("coffeequate")});